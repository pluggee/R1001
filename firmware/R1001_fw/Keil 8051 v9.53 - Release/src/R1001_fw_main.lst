C51 COMPILER V9.53.0.0   R1001_FW_MAIN                                                     09/10/2016 15:09:31 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE R1001_FW_MAIN
OBJECT MODULE PLACED IN .\src/R1001_fw_main.OBJ
COMPILER INVOKED BY: Z:\Applications\SimplicityStudio_v3\developer\toolchains\keil_8051\9.53\BIN\C51.exe /Users/sherifei
                    -d/plugge_git/R1001/firmware/R1001_fw/src/R1001_fw_main.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATF
                    -UZZY(3) OPTIMIZE(9,SPEED) DEFINE(NDEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(/Users/sherifeid/plugge_git/R1001/firmwar
                    -e/R1001_fw/inc;/Applications/SimplicityStudio_v3/developer/sdks/si8051/v3//Device/shared/si8051Base;/Applications/Simpli
                    -cityStudio_v3/developer/sdks/si8051/v3//Device/EFM8BB1;/Applications/SimplicityStudio_v3/developer/sdks/si8051/v3//Devic
                    -e/EFM8BB1/inc) REGFILE(R1001_fw.ORC) PRINT(.\src/R1001_fw_main.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src/R100
                    -1_fw_main.OBJ)

line level    source

   1          
   2          //-----------------------------------------------------------------------------
   3          // Includes
   4          //-----------------------------------------------------------------------------
   5          #include <SI_EFM8BB1_Register_Enums.h>                  // SFR declarations
   6          #include "InitDevice.h"
   7          #include "compiler_defs.h"
   8          #include "drv8825.h"
   9          #include "i2c.h"
  10          #include "global.h"
  11          
  12          // $[Generated Includes]
  13          // [Generated Includes]$
  14          
  15          //-----------------------------------------------------------------------------
  16          // Global Constants
  17          //-----------------------------------------------------------------------------
  18          
  19          //-----------------------------------------------------------------------------
  20          // Global Variables
  21          //-----------------------------------------------------------------------------
  22          //uint32_t ADC_SUM;               // Accumulates the ADC samples
  23          //bit CONV_COMPLETE;              // ADC accumulated result ready flag
  24          
  25          
  26          
  27          
  28          // Global holder for SMBus data.
  29          // All receive data is written here
  30          // NUM_BYTES_WR used because an SMBus write is Master->Slave
  31          uint8_t SMB_DATA_IN[NUM_BYTES_WR];
  32          
  33          // Global holder for SMBus data.
  34          // All transmit data is read from here
  35          // NUM_BYTES_RD used because an SMBus read is Slave->Master
  36          uint8_t SMB_DATA_OUT[NUM_BYTES_RD];
  37          
  38          bit DATA_READY = 0;                    // Set to '1' by the SMBus ISR
  39                                                 // when a new data byte has been
  40                                                 // received.
  41          
  42          // Driver Initialization function
  43          void DriverInit (void)
  44          {
  45   1              ResetDriver();
  46   1              SetDecayFast();
  47   1              SetSteppingMode(5);                     // set stepping mode to 1/32
  48   1      }
  49          
  50          
C51 COMPILER V9.53.0.0   R1001_FW_MAIN                                                     09/10/2016 15:09:31 PAGE 2   

  51          //-----------------------------------------------------------------------------
  52          // main() Routine
  53          // ----------------------------------------------------------------------------
  54          int main (void)
  55          {
  56   1              // Call hardware initialization routine
  57   1              enter_DefaultMode_from_RESET();
  58   1      
  59   1              DriverInit();                           // initialize 8825 driver
  60   1              SetI2CSlaveAddress();           // Initialize I2C slave address
  61   1      
  62   1              while (1) 
  63   1         {
  64   2                      while (!DATA_READY);             // New SMBus data received? gets out of the loop with a command transfe
             -r is complete
  65   2                      DATA_READY = 0;
  66   2      
  67   2                      // now we look at the contents of the data in the buffer and act accordingly
  68   2                      switch(SMB_DATA_IN[0]){
  69   3                      case 0x42:
  70   3                              // Return the module ID
  71   3                              // Prepare buffer with ID string
  72   3                              SMB_DATA_OUT[0] = 1;            // This is for 1000 in R1001
  73   3                              SMB_DATA_OUT[1] = 1;            // This is for 1 in R1001
  74   3                              SMB_DATA_OUT[2] = 0x2C;         // just a filler
  75   3                              break;
  76   3                      case 0x50:
  77   3                              // Set stepper motor stepping resolution
  78   3                              // This is a command to change stepping resolution, set it to the value stored in SMB_DATA_IN[1]
  79   3                              SetSteppingMode(SMB_DATA_IN[1]);
  80   3                              break;
  81   3                      case 0x20:
  82   3                              // This reads out the temperature value
  83   3                              SMB_DATA_OUT[0] = temp_val;
  84   3                              break;
  85   3                      case 0x21:
  86   3                              // This reads out the current ADC value
  87   3                              SMB_DATA_OUT[0] = TADCL;
  88   3                              SMB_DATA_OUT[1] = TADCH;
  89   3                              break;
  90   3                      case 0x22:
  91   3                              // this reads out the ADC sum bytes
  92   3                              SMB_DATA_OUT[0] = TSUM[0];
  93   3                              SMB_DATA_OUT[1] = TSUM[1];
  94   3                              SMB_DATA_OUT[2] = TSUM[2];
  95   3                              SMB_DATA_OUT[3] = TSUM[3];
  96   3                              break;
  97   3                      default:
  98   3                              break;
  99   3                      }
 100   2         }                             
 101   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     90    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
   EDATA SIZE       =   ----    ----
C51 COMPILER V9.53.0.0   R1001_FW_MAIN                                                     09/10/2016 15:09:31 PAGE 3   

   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
